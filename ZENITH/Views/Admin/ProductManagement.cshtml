@model List<ZENITH.ViewModels.ProductCardViewModel>
@{

    ViewData["Title"] = " Product Management";

    ViewData["Admin"] = "ProductManagement";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<div class="container-fluid">
    <div class="mb-3" style="display:flex;justify-content:flex-end">
        <a asp-controller="Admin" asp-action="AddProduct" class="btn btn-primary">Thêm sản phẩm</a>
    </div>
    
    <form id="admin-pm-filter-form" method="get" class="mb-3">
        <div class="form-row" style="display:flex;gap:12px;flex-wrap:wrap">
            <input type="text" name="query" value="@((string)ViewBag.Query ?? "")" class="form-control" placeholder="Tìm theo tên hoặc SKU" style="max-width:260px" />
            <select id="admin-pm-category" name="categoryId" class="form-control" style="max-width:220px" asp-items="(IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>)ViewBag.CategoryList">
                <option value="">Danh mục</option>
            </select>
            <select id="admin-pm-sport" name="sportId" class="form-control" style="max-width:220px" asp-items="(IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>)ViewBag.SportList">
                <option value="">Môn thể thao</option>
            </select>
            <select name="sort" class="form-control" style="max-width:200px">
                <option value="">Sắp xếp</option>
                <option value="name_asc">Tên A→Z</option>
                <option value="name_desc">Tên Z→A</option>
                <option value="price_asc">Giá tăng dần</option>
                <option value="price_desc">Giá giảm dần</option>
            </select>
            <button class="btn btn-primary" type="submit">Lọc</button>
        </div>
    </form>

    <div style="display:flex;flex-direction:column;min-height:60vh;width:100%">
    <div class="card">
        <div class="card-header border-0">
            <h3 class="card-title">Danh sách sản phẩm</h3>
        </div>
        <div class="card-body table-responsive p-0">
            <table class="table table-striped table-valign-middle">
                <thead>
                    <tr>
                        <th>Ảnh</th>
                        <th>Tên</th>
                        <th>SKU</th>
                        <th>Giá</th>
                        <th>Giảm</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var p in Model) {
                        <tr>
                            <td><img src="@Url.Content(p.ImageUrl)" alt="" style="width:48px;height:48px;object-fit:cover;border-radius:6px" /></td>
                            <td>@p.ProductName</td>
                            <td>@p.SkuBase</td>
                            <td>@p.Price.ToString("N0", new System.Globalization.CultureInfo("vi-VN")) VND</td>
                            <td>@(p.SalePrice>0 ? p.SalePrice.ToString("N0", new System.Globalization.CultureInfo("vi-VN"))+" VND" : "-")</td>
                            <td>
                                <a asp-controller="Admin" asp-action="EditProduct" asp-route-id="@p.ProductId" class="btn btn-sm btn-outline-primary">Sửa</a>
                                <form asp-controller="Admin" asp-action="DeleteProduct" method="post" style="display:inline" onsubmit="return confirm('Bạn có chắc muốn xoá sản phẩm này?');">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@p.ProductId" />
                                    <button type="submit" class="btn btn-sm btn-outline-danger">Xoá</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    <div class="d-flex justify-content-center align-items-center mt-3" style="gap:8px;margin-top:auto;width:100%">
        @{ var currentPage = (int)(ViewBag.Page ?? 1); var totalPages = (int)(ViewBag.TotalPages ?? 1); var prev = currentPage > 1 ? currentPage - 1 : 1; var next = currentPage < totalPages ? currentPage + 1 : totalPages; }
        <a class="btn btn-outline-secondary"
           asp-controller="Admin" asp-action="ProductManagement"
           asp-route-query="@((string)ViewBag.Query ?? "")" asp-route-categoryId="@ViewBag.CategoryList?.SelectedValue" asp-route-sportId="@ViewBag.SportList?.SelectedValue" asp-route-sort="@((string)ViewBag.Sort ?? "")"
           asp-route-page="@prev" asp-route-pageSize="@ViewBag.PageSize">Trang trước</a>
        <span>Trang @currentPage/@totalPages</span>
        <a class="btn btn-outline-secondary"
           asp-controller="Admin" asp-action="ProductManagement"
           asp-route-query="@((string)ViewBag.Query ?? "")" asp-route-categoryId="@ViewBag.CategoryList?.SelectedValue" asp-route-sportId="@ViewBag.SportList?.SelectedValue" asp-route-sort="@((string)ViewBag.Sort ?? "")"
           asp-route-page="@next" asp-route-pageSize="@ViewBag.PageSize">Trang sau</a>
    </div>
    </div>
</div>
<script>
(function(){
  var form = document.getElementById('admin-pm-filter-form');
  if (!form) return;
  var sport = document.getElementById('admin-pm-sport');
  var cat = document.getElementById('admin-pm-category');
  if (sport) {
    sport.addEventListener('change', function(){
      if (cat) { cat.value = ''; }
      form.submit();
    });
  }
})();
</script>
